#! /usr/bin/env ruby

require "rubygems"
require "bundler/setup"
require "eventmachine"

require "mailroom"

timers = {}

trap("QUIT") do
  Mailroom::MailSpoolSnapshotter.halt!
end

trap("INT") do
  EventMachine::stop_event_loop
end

EventMachine::run do
  ARGV.each do |mailspool|
    Mailroom::MailSpoolSnapshotter.new(mailspool)
  end
end

Mailroom.logger.info "Exiting."
